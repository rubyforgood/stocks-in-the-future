<%# Redesigned Portfolio Page %>
<div class="max-w-[1180px] mx-auto space-y-6" style="font-family: Inter, system-ui, sans-serif;">
  <!-- Header with badge icons and title -->
  <div class="flex items-center gap-3">
    <div class="flex items-center gap-1 text-2xl"><span>ðŸ“™ðŸ’°</span></div>
    <h1 class="text-lg md:text-xl font-medium tracking-wide"><%= @portfolio.user.username.upcase %>, PORTFOLIO <span class="font-normal text-gray-500">| <%= @portfolio.user.school&.name %></span></h1>
  </div>

  <% if @portfolio.user.student? && !@portfolio.user.classroom&.trading_enabled? %>
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <p class="text-sm font-medium text-yellow-800">Trading is currently disabled for your classroom.</p>
          <p class="mt-1 text-sm text-yellow-700">You cannot place buy or sell orders at this time. Please contact your teacher for more information.</p>
        </div>
      </div>
    </div>
  <% end %>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left area (spans 2 columns on large screens): metrics + holdings table -->
    <div class="flex flex-col gap-6 lg:col-span-2">
      <%= render 'portfolios/portfolio_chart' %>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <%# Total Earnings Card %>
        <div class="bg-white rounded-[22px] border border-black/30 py-4 px-5 flex flex-col justify-between min-h-[120px]">
          <div class="text-sm text-gray-600">Total Earnings</div>
          <div class="text-2xl font-semibold"><%= number_to_currency(@portfolio.cash_balance) %></div>
          <div><%# Trending up/down this month will go here %></div>
        </div>
        <%# Total Cash Value %>
        <div class="bg-white rounded-[22px] border border-black/30 py-4 px-5 flex flex-col justify-between min-h-[120px]">
          <div class="text-sm text-gray-600">Total Cash Value</div>
          <div class="text-2xl font-semibold">$<%= sprintf('%.2f', @portfolio.cash_balance) %></div>
          <div><%# Trending up/down this month will go here %></div>
        </div>
        <%# Total Stock Buys %>
        <div class="bg-white rounded-[22px] border border-black/30 py-4 px-5 flex flex-col justify-between min-h-[120px]">
          <div class="text-sm text-gray-600">Total Stock Buys</div>
          <div class="text-2xl font-semibold"><%= @portfolio.portfolio_transactions.where(transaction_type: 'buy').count %></div>
          <div><%# Trending up/down this month will go here %></div>
        </div>
      </div>
      <!-- Holdings Table -->
      <div class="rounded-xl border border-black/60 bg-white overflow-hidden">
        <table class="w-full border-collapse">
          <colgroup>
            <col class="w-[34%]">
            <col class="w-[8%]">
            <col class="w-[18%]">
            <col class="w-[18%]">
            <col class="w-[18%]">
            <col class="w-[14%]">
          </colgroup>
          <thead>
            <tr class="bg-amber-300/95 text-[13px]">
              <th scope="col" class="text-left py-3 pl-6 pr-4 font-medium">Current Holdings</th>
              <th scope="col" class="text-left py-3 px-4 font-medium">Qty.</th>
              <th scope="col" class="text-left py-3 px-4 font-medium">Last Price</th>
              <th scope="col" class="text-left py-3 px-4 font-medium">Change</th>
              <th scope="col" class="text-left py-3 px-4 font-medium">Total Return</th>
              <th class="py-3 pr-6"></th>
            </tr>
          </thead>
          <tbody class="text-[14px]">
            <% @portfolio.positions.each do |position| %>
              <% price = position.stock_current_price %>
              <% shares = position.shares %>
              <% change_amount = position.change_amount %>
              <% total_return_amount = position.total_return_amount %>
              <tr class="border-t first:border-t-0 border-black/40">
                <td class="py-4 pl-6 pr-4 align-middle">
                  <div class="flex items-center gap-3">
                    <span class="font-medium"><%= position.stock_ticker %></span>
                  </div>
                </td>
                <td class="py-4 px-4 align-middle"><%= shares %></td>
                <td class="py-4 px-4 align-middle tabular-nums"><%= number_to_currency(price) %></td>
                <td class="py-4 px-4 align-middle tabular-nums <%= change_amount >= 0 ? 'text-green-600' : 'text-red-600' %>">
                  <% if change_amount >= 0 %>+<% end %> <%= number_to_currency(change_amount) %>
                </td>
                <td class="py-4 px-4 align-middle tabular-nums <%= total_return_amount >= 0 ? 'text-green-600' : 'text-red-600' %>">
                  <% if total_return_amount >= 0 %>+<% end %> <%= number_to_currency(total_return_amount) %>
                </td>
                <td class="py-3 pr-6 align-middle">
                  <%= link_to "Trade", stocks_path, class: "inline-flex items-center justify-center rounded-full bg-sky-800 text-white px-6 py-2 text-sm font-medium shadow hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-1 transition-colors" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Right column (single column on large screens): My Earnings to Invest + Summary -->
    <div class="flex flex-col gap-6 lg:col-span-1">
      <%= render 'portfolios/earnings_to_invest_card' %>
      <%= render 'portfolios/earnings_summary_card' %>
    </div>
  </div>
</div>
