<%# Redesigned Portfolio Page %>
<div class="max-w-[1180px] mx-auto space-y-6" style="font-family: Inter, system-ui, sans-serif;">
  <!-- Header with badge icons and title -->
  <div class="flex items-center gap-3">
    <div class="flex items-center gap-1 text-2xl"><span>ðŸ“™ðŸ’°</span></div>
    <h1 class="text-lg md:text-xl font-medium tracking-wide"><%= @portfolio.user.username.upcase %>, PORTFOLIO <span class="font-normal text-gray-500">| <%= @portfolio.user.school&.name %></span></h1>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left area (spans 2 columns on large screens): metrics + holdings table -->
    <div class="flex flex-col gap-6 lg:col-span-2">
      <%= render 'portfolios/portfolio_chart' %>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <%# Total Earnings Card %>
        <div class="bg-white rounded-[22px] border border-black/30 py-4 px-5 flex flex-col justify-between min-h-[120px]">
          <div class="text-sm text-gray-600">Total Earnings</div>
          <div class="text-2xl font-semibold"><%= number_to_currency(@portfolio.cash_balance) %></div>
          <div><%# Trending up/down this month will go here %></div>
        </div>
        <%# Total Cash Value %>
        <div class="bg-white rounded-[22px] border border-black/30 py-4 px-5 flex flex-col justify-between min-h-[120px]">
          <div class="text-sm text-gray-600">Total Cash Value</div>
          <div class="text-2xl font-semibold">$<%= sprintf('%.2f', @portfolio.cash_balance) %></div>
          <div><%# Trending up/down this month will go here %></div>
        </div>
        <%# Total Stock Buys %>
        <div class="bg-white rounded-[22px] border border-black/30 py-4 px-5 flex flex-col justify-between min-h-[120px]">
          <div class="text-sm text-gray-600">Total Stock Buys</div>
          <div class="text-2xl font-semibold"><%= @portfolio.portfolio_transactions.where(transaction_type: 'buy').count %></div>
          <div><%# Trending up/down this month will go here %></div>
        </div>
      </div>
      <!-- Holdings Table -->
      <div class="rounded-xl border border-black/60 bg-white overflow-hidden">
        <table class="w-full border-collapse">
          <colgroup>
            <col class="w-[34%]">
            <col class="w-[8%]">
            <col class="w-[18%]">
            <col class="w-[18%]">
            <col class="w-[18%]">
            <col class="w-[14%]">
          </colgroup>
          <thead>
            <tr class="bg-amber-300/95 text-[13px]">
              <th scope="col" class="text-left py-3 pl-6 pr-4 font-medium">Current Holdings</th>
              <th scope="col" class="text-left py-3 px-4 font-medium">Qty.</th>
              <th scope="col" class="text-left py-3 px-4 font-medium">Last Price</th>
              <th scope="col" class="text-left py-3 px-4 font-medium">Change</th>
              <th scope="col" class="text-left py-3 px-4 font-medium">Total Return</th>
              <th class="py-3 pr-6"></th>
            </tr>
          </thead>
          <tbody class="text-[14px]">
            <% @portfolio.positions.each do |position| %>
              <% price = position.stock_current_price %>
              <% shares = position.shares %>
              <% change_amount = position.change_amount %>
              <% total_return_amount = position.total_return_amount %>
              <% logo_path = "stock_logos/#{position.stock_ticker}-logo.svg" %>
              <tr class="border-t first:border-t-0 border-black/40">
                <td class="py-4 pl-6 pr-4 align-middle">
                  <div class="flex items-center gap-4">
                    <% if File.exist?("app/assets/images/#{logo_path}") %>
                      <%= image_tag asset_path(logo_path),
                                    class: "w-10 h-10 rounded-lg flex-shrink-0",
                                    alt: "#{position.stock_ticker} logo",
                                    loading: "lazy" %>
                    <% end %>
                    <div class="flex flex-col">
                      <span class="font-medium"><%= position.stock_ticker %></span>
                    </div>
                  </div>
                </td>
                <td class="py-4 px-4 align-middle"><%= shares %></td>
                <td class="py-4 px-4 align-middle tabular-nums"><%= number_to_currency(price) %></td>
                <td class="py-4 px-4 align-middle tabular-nums <%= change_amount >= 0 ? 'text-green-600' : 'text-red-600' %>">
                  <% if change_amount >= 0 %>+<% end %> <%= number_to_currency(change_amount) %>
                </td>
                <td class="py-4 px-4 align-middle tabular-nums <%= total_return_amount >= 0 ? 'text-green-600' : 'text-red-600' %>">
                  <% if total_return_amount >= 0 %>+<% end %> <%= number_to_currency(total_return_amount) %>
                </td>
                <td class="py-3 pr-6 align-middle">
                  <%= link_to "Trade", stocks_path, class: "inline-flex items-center justify-center rounded-full bg-sky-800 text-white px-6 py-2 text-sm font-medium shadow hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-1 transition-colors" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Right column (single column on large screens): My Earnings to Invest + Summary -->
    <div class="flex flex-col gap-6 lg:col-span-1">
      <%= render 'portfolios/earnings_to_invest_card' %>
      <%= render 'portfolios/earnings_summary_card' %>
    </div>
  </div>
</div>
