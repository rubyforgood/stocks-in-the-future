<%= form_with model: portfolio_transaction, url: portfolio_transaction.persisted? ? admin_v2_portfolio_transaction_path(portfolio_transaction) : admin_v2_portfolio_transactions_path, builder: AdminV2::FormBuilder, class: "space-y-6" do |f| %>
  <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-lg">
    <div class="px-6 py-6">
      <h3 class="text-lg font-medium text-gray-900 mb-6">Transaction Details</h3>

      <%= f.association_select :portfolio_id,
                               collection: Portfolio.includes(:user).order("users.username"),
                               label: "Portfolio",
                               label_method: ->(portfolio) { "#{portfolio.user.username} (ID: #{portfolio.id})" },
                               hint: "Select the portfolio for this transaction" %>

      <%= f.select :transaction_type,
                   PortfolioTransaction.transaction_types.keys.map { |type| [type.humanize, type] },
                   label: "Transaction Type",
                   hint: "Type of transaction (deposit, withdrawal, credit, debit, fee)",
                   include_blank: "Select transaction type..." %>

      <%= f.select :reason,
                   PortfolioTransaction.reasons.keys.map { |r| [r.humanize, r] },
                   label: "Reason",
                   hint: "Reason for this transaction (optional)",
                   include_blank: "Select reason..." %>

      <%= f.currency_field :amount_cents,
                           label: "Amount",
                           hint: "Transaction amount in dollars",
                           multiplier: 0.01,
                           decimals: 2 %>

      <%= f.text_area :description,
                      label: "Description",
                      hint: "Optional description for this transaction",
                      rows: 4 %>
    </div>
  </div>

  <div class="flex items-center justify-end gap-x-4">
    <%= f.cancel_button "Cancel", url: portfolio_transaction.persisted? ? admin_v2_portfolio_transaction_path(portfolio_transaction) : admin_v2_root_path %>
    <%= f.submit_button portfolio_transaction.persisted? ? "Update Portfolio Transaction" : "Create Portfolio Transaction" %>
  </div>
<% end %>
