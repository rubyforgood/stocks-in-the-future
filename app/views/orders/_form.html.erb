<%= form_with(model: order,
              class: "w-full max-w-lg",
              data: {
                controller: "order-form",
                order_form_current_price_value: order.stock.current_price,
                order_form_transaction_fee_value: order.transaction_fee_dollars,
                turbo_frame: "_top"
              }) do |form| %>
  <% if order.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
        <% order.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <p class="text-3xl text-center pb-3"><%= order.action&.titlecase %> Shares</p>
    <hr class="py-3"></hr>
    <p class="text-center"><%= order.stock.ticker %></p>
    <p class="text-center text-sm">Current Price <%= number_to_currency(order.stock.current_price) %></p>

    <div class="py-3">
      <p class="bg-green-500 bg-opacity-25 p-2 border-green-800 text-md font-bold">
        Current earnings to Invest: <%= number_to_currency(current_user&.portfolio&.cash_balance) %>
      </p>
    </div>

    <div class="py-3">
      <p class="text-sm">
        Shares Owned: <%= shares_owned %>
      </p>
    </div>
    <hr class="py-3"></hr>

    <div class="pb-3">
      <%= form.label "# of shares #{order.action == 'buy' ? 'buying' : 'selling'}" %>
      <%= form.number_field :shares, min: 1, required: true, class: "shadow-sm appearance-none border rounded-smw-full py-2 px-3 text-gray-700 leading-tight focus:outline-hidden focus:shadow-outline", data: { order_form_target: "shares", action: "input->order-form#calculateTotal" } %>
      <p class="text-sm">
        Transaction Fee:
        <span class="text-red-500"><%= number_to_currency order.transaction_fee_cents / 100.0 %></span>
      </p>
    </div>
    <hr class="py-3"></hr>


    <div class="pb-3">
      <p class="text-sm font-semibold text-gray-700">Total <%= order.action == 'buy' ? 'Cost' : 'Earnings' %>
        : <span data-order-form-target="totalCost">$0.00</span>
      </p>
    </div>

    <%= form.hidden_field :action, value: order.action %>
    <%= form.hidden_field :stock_id, value: order.stock.id %>
    <div>
      <%= form.submit "Confirm #{order.action&.titlecase}", class: "cursor-pointer rounded-lg bg-[#00698c] px-4 py-2 text-sm font-semibold text-white shadow-xs hover:bg-[#004f6b] focus-visible:outline-2 focus-visible:outline-offset-2" %>
    </div>
  </div>
<% end %>
